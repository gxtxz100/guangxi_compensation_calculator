<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¿è¥¿äººèº«æŸå®³èµ”å¿è®¡ç®—å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "Microsoft YaHei", "SimHei", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 30px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #667eea;
        }
        
        .header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 14px;
        }
        
        .form-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .form-section h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .form-section h2::before {
            content: "ğŸ“‹";
            margin-right: 8px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="number"],
        select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            justify-content: center;
        }
        
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-calculate {
            background: #27ae60;
            color: white;
        }
        
        .btn-calculate:hover {
            background: #229954;
        }
        
        .btn-export {
            background: #3498db;
            color: white;
        }
        
        .btn-export:hover {
            background: #2980b9;
        }
        
        .btn-clear {
            background: #95a5a6;
            color: white;
        }
        
        .btn-clear:hover {
            background: #7f8c8d;
        }
        
        .result-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #27ae60;
        }
        
        .result-section h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .result-content {
            background: white;
            padding: 20px;
            border-radius: 5px;
            font-family: "Consolas", "Courier New", monospace;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .hidden {
            display: none;
        }
        
        .error {
            color: #e74c3c;
            background: #fadbd8;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .success {
            color: #27ae60;
            background: #d5f4e6;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å¹¿è¥¿äººèº«æŸå®³èµ”å¿è®¡ç®—å™¨</h1>
            <p>æ ¹æ®ï¼ˆæ¡‚é«˜æ³•ä¼šã€”2025ã€•13å·ï¼‰ï¼Œï¼ˆæ¡‚å…¬é€šã€”2025ã€•60å·ï¼‰</p>
        </div>
        
        <form id="compensationForm">
            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <div class="form-section">
                <h2>åŸºæœ¬ä¿¡æ¯</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>å—å®³äººå§“åï¼š</label>
                        <input type="text" name="victim_name" id="victim_name">
                    </div>
                    <div class="form-group">
                        <label>å—å®³äººå¹´é¾„ï¼š</label>
                        <input type="number" name="victim_age" id="victim_age" min="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>äº‹æ•…å‘ç”Ÿæ—¥æœŸï¼š</label>
                        <input type="date" name="accident_date" id="accident_date">
                    </div>
                </div>
            </div>
            
            <!-- åŒ»ç–—ç›¸å…³è´¹ç”¨ -->
            <div class="form-section">
                <h2>åŒ»ç–—ç›¸å…³è´¹ç”¨</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>åŒ»ç–—è´¹ï¼ˆå…ƒï¼‰ï¼š</label>
                        <input type="number" name="medical_expense" id="medical_expense" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label>åç»­æ²»ç–—è´¹ï¼ˆå…ƒï¼‰ï¼š</label>
                        <input type="number" name="follow_up_treatment_fee" id="follow_up_treatment_fee" step="0.01" min="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ä½é™¢å¤©æ•°ï¼š</label>
                        <input type="number" name="hospital_days" id="hospital_days" min="0">
                    </div>
                    <div class="form-group">
                        <label>ä½é™¢ä¼™é£Ÿè¡¥åŠ©è´¹ï¼ˆå…ƒ/å¤©ï¼Œé»˜è®¤100ï¼‰ï¼š</label>
                        <input type="number" name="meal_subsidy" id="meal_subsidy" step="0.01" min="0" value="100">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>è¥å…»è´¹ï¼ˆå…ƒï¼‰ï¼š</label>
                        <input type="number" name="nutrition_fee" id="nutrition_fee" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label>äº¤é€šè´¹ï¼ˆå…ƒï¼‰ï¼š</label>
                        <input type="number" name="traffic_fee" id="traffic_fee" step="0.01" min="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ä½å®¿å¤©æ•°ï¼š</label>
                        <input type="number" name="accommodation_days" id="accommodation_days" min="0">
                    </div>
                </div>
            </div>
            
            <!-- è¯¯å·¥è´¹ -->
            <div class="form-section">
                <h2>è¯¯å·¥è´¹</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>æ”¶å…¥ç±»å‹ï¼š</label>
                        <select name="work_income_type" id="work_income_type" onchange="toggleWorkIncomeFields()">
                            <option value="å›ºå®šæ”¶å…¥">å›ºå®šæ”¶å…¥</option>
                            <option value="æ— å›ºå®šæ”¶å…¥ï¼ˆèƒ½è¯æ˜æœ€è¿‘ä¸‰å¹´å¹³å‡ï¼‰">æ— å›ºå®šæ”¶å…¥ï¼ˆèƒ½è¯æ˜æœ€è¿‘ä¸‰å¹´å¹³å‡ï¼‰</option>
                            <option value="æ— å›ºå®šæ”¶å…¥ï¼ˆä¸èƒ½è¯æ˜ï¼Œå‚ç…§è¡Œä¸šå¹³å‡ï¼‰">æ— å›ºå®šæ”¶å…¥ï¼ˆä¸èƒ½è¯æ˜ï¼Œå‚ç…§è¡Œä¸šå¹³å‡ï¼‰</option>
                        </select>
                    </div>
                    <div class="form-group" id="monthly_income_group">
                        <label>æœˆæ”¶å…¥ï¼ˆå…ƒï¼‰ï¼š</label>
                        <input type="number" name="monthly_income" id="monthly_income" step="0.01" min="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group hidden" id="avg_daily_income_group">
                        <label>æ—¥å‡æ”¶å…¥ï¼ˆå…ƒï¼‰ï¼š</label>
                        <input type="number" name="avg_daily_income" id="avg_daily_income" step="0.01" min="0">
                    </div>
                    <div class="form-group hidden" id="industry_type_group">
                        <label>è¡Œä¸šç±»å‹ï¼š</label>
                        <select name="industry_type" id="industry_type">
                            {% for industry in industry_salaries %}
                            <option value="{{ industry }}">{{ industry }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>è¯¯å·¥å¤©æ•°ï¼š</label>
                        <input type="number" name="work_loss_days" id="work_loss_days" min="0">
                    </div>
                </div>
            </div>
            
            <!-- æŠ¤ç†è´¹ -->
            <div class="form-section">
                <h2>æŠ¤ç†è´¹</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>æŠ¤ç†äººå‘˜ç±»å‹ï¼š</label>
                        <select name="nursing_type" id="nursing_type" onchange="toggleNursingFields()">
                            <option value="æœ‰æ”¶å…¥">æœ‰æ”¶å…¥</option>
                            <option value="æ— æ”¶å…¥æˆ–é›‡ä½£æŠ¤å·¥">æ— æ”¶å…¥æˆ–é›‡ä½£æŠ¤å·¥</option>
                        </select>
                    </div>
                    <div class="form-group" id="nursing_income_group">
                        <label>æŠ¤ç†äººå‘˜æ—¥å‡æ”¶å…¥ï¼ˆå…ƒï¼‰ï¼š</label>
                        <input type="number" name="nursing_income" id="nursing_income" step="0.01" min="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>æŠ¤ç†å¤©æ•°ï¼š</label>
                        <input type="number" name="nursing_days" id="nursing_days" min="0">
                    </div>
                    <div class="form-group">
                        <label>æŠ¤ç†äººæ•°ï¼ˆé»˜è®¤1äººï¼‰ï¼š</label>
                        <input type="number" name="nursing_count" id="nursing_count" min="1" value="1">
                    </div>
                </div>
            </div>
            
            <!-- æ®‹ç–¾èµ”å¿ -->
            <div class="form-section" id="disability_section">
                <h2>æ®‹ç–¾èµ”å¿</h2>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>ä¼¤æ®‹ç­‰çº§ï¼ˆæ”¯æŒå¤šå¤„ä¼¤æ®‹ï¼Œç”¨é€—å·æˆ–åˆ†å·åˆ†éš”ï¼Œå¦‚ï¼š5çº§,8çº§ï¼‰ï¼š</label>
                        <input type="text" name="disability_level" id="disability_level" placeholder="æ— ">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>æ®‹ç–¾è¾…åŠ©å™¨å…·è´¹ï¼ˆå…ƒï¼‰ï¼š</label>
                        <input type="number" name="disability_appliance_fee" id="disability_appliance_fee" step="0.01" min="0">
                    </div>
                </div>
            </div>
            
            <!-- è¢«æ‰¶å…»äººç”Ÿæ´»è´¹ -->
            <div class="form-section">
                <h2>è¢«æ‰¶å…»äººç”Ÿæ´»è´¹</h2>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>è¢«æ‰¶å…»äººä¿¡æ¯ï¼ˆæ ¼å¼ï¼šå¹´é¾„1,æ‰¶å…»äººæ•°1;å¹´é¾„2,æ‰¶å…»äººæ•°2ï¼Œå¦‚ï¼š5,2;65,1ï¼‰ï¼š</label>
                        <input type="text" name="dependent_info" id="dependent_info" placeholder="å¦‚ï¼š5,2;65,1">
                    </div>
                </div>
            </div>
            
            <!-- æ­»äº¡èµ”å¿ -->
            <div class="form-section">
                <h2>æ­»äº¡èµ”å¿ï¼ˆå¦‚é€‚ç”¨ï¼‰</h2>
                <div class="form-row">
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" name="is_death" id="is_death" onchange="toggleDeathFields()">
                            <label for="is_death">æ˜¯å¦æ­»äº¡</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç²¾ç¥æŸå®³æŠšæ…°é‡‘ -->
            <div class="form-section">
                <h2>ç²¾ç¥æŸå®³æŠšæ…°é‡‘</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>ç²¾ç¥æŸå®³æŠšæ…°é‡‘ï¼ˆå…ƒï¼‰ï¼š</label>
                        <input type="number" name="mental_damage" id="mental_damage" step="0.01" min="0">
                    </div>
                </div>
            </div>
            
            <!-- æŒ‰é’®ç»„ -->
            <div class="btn-group">
                <button type="button" class="btn-calculate" onclick="calculate()">âœ“ è®¡ç®—èµ”å¿</button>
                <button type="button" class="btn-export" onclick="exportWord()">ğŸ“„ å¯¼å‡ºWord</button>
                <button type="button" class="btn-clear" onclick="clearForm()">ğŸ—‘ï¸ æ¸…ç©º</button>
            </div>
        </form>
        
        <!-- ç»“æœæ˜¾ç¤º -->
        <div class="result-section hidden" id="result_section">
            <h2>è®¡ç®—ç»“æœ</h2>
            <div class="result-content" id="result_content"></div>
        </div>
        
        <div id="message"></div>
    </div>
    
    <script>
        let calculationData = null;
        
        function toggleWorkIncomeFields() {
            const incomeType = document.getElementById('work_income_type').value;
            const monthlyGroup = document.getElementById('monthly_income_group');
            const avgDailyGroup = document.getElementById('avg_daily_income_group');
            const industryGroup = document.getElementById('industry_type_group');
            
            if (incomeType === 'å›ºå®šæ”¶å…¥') {
                monthlyGroup.classList.remove('hidden');
                avgDailyGroup.classList.add('hidden');
                industryGroup.classList.add('hidden');
            } else if (incomeType === 'æ— å›ºå®šæ”¶å…¥ï¼ˆèƒ½è¯æ˜æœ€è¿‘ä¸‰å¹´å¹³å‡ï¼‰') {
                monthlyGroup.classList.add('hidden');
                avgDailyGroup.classList.remove('hidden');
                industryGroup.classList.add('hidden');
            } else {
                monthlyGroup.classList.add('hidden');
                avgDailyGroup.classList.add('hidden');
                industryGroup.classList.remove('hidden');
            }
        }
        
        function toggleNursingFields() {
            const nursingType = document.getElementById('nursing_type').value;
            const nursingIncomeGroup = document.getElementById('nursing_income_group');
            
            if (nursingType === 'æœ‰æ”¶å…¥') {
                nursingIncomeGroup.classList.remove('hidden');
            } else {
                nursingIncomeGroup.classList.add('hidden');
            }
        }
        
        function toggleDeathFields() {
            const isDeath = document.getElementById('is_death').checked;
            const disabilitySection = document.getElementById('disability_section');
            
            if (isDeath) {
                disabilitySection.classList.add('hidden');
            } else {
                disabilitySection.classList.remove('hidden');
            }
        }
        
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.className = type;
            messageDiv.textContent = text;
            messageDiv.classList.remove('hidden');
            
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000);
        }
        
        function calculate() {
            const form = document.getElementById('compensationForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                if (key === 'is_death') {
                    data[key] = document.getElementById('is_death').checked;
                } else {
                    data[key] = value;
                }
            }
            
            fetch('/api/calculate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    calculationData = result;
                    displayResults(result);
                    showMessage('è®¡ç®—å®Œæˆï¼', 'success');
                } else {
                    showMessage('è®¡ç®—å¤±è´¥ï¼š' + result.error, 'error');
                }
            })
            .catch(error => {
                showMessage('è®¡ç®—å¤±è´¥ï¼š' + error.message, 'error');
            });
        }
        
        function displayResults(result) {
            const resultSection = document.getElementById('result_section');
            const resultContent = document.getElementById('result_content');
            
            let output = '='.repeat(50) + '\n';
            output += 'å¹¿è¥¿äººèº«æŸå®³èµ”å¿è®¡ç®—ç»“æœ\n';
            output += '='.repeat(50) + '\n\n';
            output += `å—å®³äººå§“åï¼š${result.victim_name}\n`;
            output += `å—å®³äººå¹´é¾„ï¼š${result.victim_age}å²\n`;
            output += `è®¡ç®—æ—¥æœŸï¼š${new Date().toLocaleString('zh-CN')}\n`;
            output += '\n' + '-'.repeat(50) + '\n';
            output += 'å„é¡¹èµ”å¿æ˜ç»†ï¼š\n';
            output += '-'.repeat(50) + '\n\n';
            
            const itemsOrder = ['åŒ»ç–—è´¹', 'åç»­æ²»ç–—è´¹', 'è¯¯å·¥è´¹', 'æŠ¤ç†è´¹', 'äº¤é€šè´¹', 'ä½å®¿è´¹', 'ä½é™¢ä¼™é£Ÿè¡¥åŠ©è´¹', 
                              'è¥å…»è´¹', 'æ®‹ç–¾èµ”å¿é‡‘', 'æ®‹ç–¾è¾…åŠ©å™¨å…·è´¹', 'è¢«æ‰¶å…»äººç”Ÿæ´»è´¹', 
                              'æ­»äº¡èµ”å¿é‡‘', 'ä¸§è‘¬è´¹', 'ç²¾ç¥æŸå®³æŠšæ…°é‡‘'];
            
            for (let item of itemsOrder) {
                if (result.results[item] && result.results[item] > 0) {
                    output += `${item.padEnd(20)}ï¼š${result.results[item].toLocaleString('zh-CN', {minimumFractionDigits: 2, maximumFractionDigits: 2}).padStart(15)} å…ƒ\n`;
                }
            }
            
            output += '\n' + '-'.repeat(50) + '\n';
            output += `${'æ€»è®¡'.padEnd(20)}ï¼š${result.results['æ€»è®¡'].toLocaleString('zh-CN', {minimumFractionDigits: 2, maximumFractionDigits: 2}).padStart(15)} å…ƒ\n`;
            output += '='.repeat(50) + '\n';
            
            resultContent.textContent = output;
            resultSection.classList.remove('hidden');
        }
        
        function exportWord() {
            if (!calculationData) {
                showMessage('è¯·å…ˆè¿›è¡Œè®¡ç®—ï¼', 'error');
                return;
            }
            
            const form = document.getElementById('compensationForm');
            const formData = new FormData(form);
            const data = {
                ...calculationData,
                accident_date: formData.get('accident_date') || new Date().toISOString().split('T')[0]
            };
            
            fetch('/api/export_word', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (response.ok) {
                    return response.blob();
                }
                return response.json().then(err => Promise.reject(err));
            })
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${calculationData.victim_name !== 'æœªå¡«å†™' ? calculationData.victim_name : 'èµ”å¿'}è®¡ç®—ç»“æœ.docx`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                showMessage('Wordæ–‡æ¡£å¯¼å‡ºæˆåŠŸï¼', 'success');
            })
            .catch(error => {
                showMessage('å¯¼å‡ºå¤±è´¥ï¼š' + (error.error || error.message), 'error');
            });
        }
        
        function clearForm() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                document.getElementById('compensationForm').reset();
                document.getElementById('result_section').classList.add('hidden');
                calculationData = null;
                document.getElementById('accident_date').value = new Date().toISOString().split('T')[0];
                document.getElementById('meal_subsidy').value = '100';
                document.getElementById('nursing_count').value = '1';
                toggleWorkIncomeFields();
                toggleNursingFields();
                toggleDeathFields();
            }
        }
        
        // åˆå§‹åŒ–
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('accident_date').value = today;
    </script>
</body>
</html>

